[general]
static=yes

[geral]
exten => _+35194XXXXXXX,1,Answer()
exten => _+35194XXXXXXX,2,Set(callCheck=${CURL(http://192.168.1.10:8080/v1/callAllowed/${CALLERID(num)})})
exten => _+35194XXXXXXX,3,GotoIf($["${callCheck}" = "notactivated"]?notactivated:activated)
exten => _+35194XXXXXXX,4(activated),GotoIf($["${callCheck}" = "balanceok"]?balanceok:nobalance)
exten => _+35194XXXXXXX,5(nobalance),GotoIf($["${callCheck}" = "extracall"]?extracall:nobalancenoextra)
exten => _+35194XXXXXXX,6(notactivated),Playback(/usr/share/asterisk/welcome)
exten => _+35194XXXXXXX,7,Hangup()
exten => _+35194XXXXXXX,8(extracall),Read(actionBalance,/usr/share/asterisk/extracall,1,i,1,5)
exten => _+35194XXXXXXX,9,GotoIf($["${actionBalance}" = "1"]?startCostCall)
exten => _+35194XXXXXXX,10,Hangup()
exten => _+35194XXXXXXX,11(startCostCall),Set(CHANNEL(hangup_handler_push)=regExtraInter,_+35194XXXXXXX,1)
exten => _+35194XXXXXXX,12,Set(ringTone=${CURL(http://192.168.1.10:8080/v1/ringTone/${EXTEN})})
exten => _+35194XXXXXXX,13,GotoIf($["${ringTone}" = "5c5c28c0-2aea-4334-8188-b2a1674a4932"]?noRingDingF:withRingDingF)
exten => _+35194XXXXXXX,14(noRingDingF),DIAL(SIP/${EXTEN},60)
exten => _+35194XXXXXXX,15,Hangup()
exten => _+35194XXXXXXX,16(withRingDingF),DIAL(SIP/${EXTEN},60,m(${ringTone}))
exten => _+35194XXXXXXX,17,Hangup()
exten => _+35194XXXXXXX,18(balanceok),Set(ringTone=${CURL(http://192.168.1.10:8080/v1/ringTone/${EXTEN})})
exten => _+35194XXXXXXX,19,GotoIf($["${ringTone}" = "5c5c28c0-2aea-4334-8188-b2a1674a4932"]?noRingDingS:withRingDingS)
exten => _+35194XXXXXXX,20(noRingDingS),DIAL(SIP/${EXTEN},60)
exten => _+35194XXXXXXX,21,Hangup()
exten => _+35194XXXXXXX,22(withRingDingS),DIAL(SIP/${EXTEN},60,m(${ringTone}))
exten => _+35194XXXXXXX,23,Hangup()
exten => _+35194XXXXXXX,24(nobalancenoextra),Background(/usr/share/asterisk/balance)
exten => _+35194XXXXXXX,25,Hangup()

exten => _94XXXXXXX,1,Answer()
exten => _94XXXXXXX,2,Set(callCheck=${CURL(http://192.168.1.10:8080/v1/callAllowed/${CALLERID(num)})})
exten => _94XXXXXXX,3,GotoIf($["${callCheck}" = "notactivated"]?notactivated:activated)
exten => _94XXXXXXX,4(activated),GotoIf($["${callCheck}" = "balanceok"]?balanceok:nobalance)
exten => _94XXXXXXX,5(nobalance),GotoIf($["${callCheck}" = "extracall"]?extracall:nobalancenoextra)
exten => _94XXXXXXX,6(notactivated),Playback(/usr/share/asterisk/welcome)
exten => _94XXXXXXX,7,Hangup()
exten => _94XXXXXXX,8(extracall),Read(actionBalance,/usr/share/asterisk/extracall,1,i,1,5)
exten => _94XXXXXXX,9,GotoIf($["${actionBalance}" = "1"]?startCostCall)
exten => _94XXXXXXX,10,Hangup()
exten => _94XXXXXXX,11(startCostCall),Set(CHANNEL(hangup_handler_push)=regExtra,_94XXXXXXX,1)
exten => _94XXXXXXX,12,Set(ringTone=${CURL(http://192.168.1.10:8080/v1/ringTone/${EXTEN})})
exten => _94XXXXXXX,13,GotoIf($["${ringTone}" = "5c5c28c0-2aea-4334-8188-b2a1674a4932"]?noRingDingF:withRingDingF)
exten => _94XXXXXXX,14(noRingDingF),DIAL(SIP/+351${EXTEN},60)
exten => _94XXXXXXX,15,Hangup()
exten => _94XXXXXXX,16(withRingDingF),DIAL(SIP/+351${EXTEN},60,m(${ringTone}))
exten => _94XXXXXXX,17,Hangup()
exten => _94XXXXXXX,18(balanceok),Set(ringTone=${CURL(http://192.168.1.10:8080/v1/ringTone/${EXTEN})})
exten => _94XXXXXXX,19,GotoIf($["${ringTone}" = "5c5c28c0-2aea-4334-8188-b2a1674a4932"]?noRingDingS:withRingDingS)
exten => _94XXXXXXX,20(noRingDingS),DIAL(SIP/+351${EXTEN},60)
exten => _94XXXXXXX,21,Hangup()
exten => _94XXXXXXX,22(withRingDingS),DIAL(SIP/+351${EXTEN},60,m(${ringTone}))
exten => _94XXXXXXX,23,Hangup()
exten => _94XXXXXXX,24(nobalancenoextra),Background(/usr/share/asterisk/balance)
exten => _94XXXXXXX,25,Hangup()

[regExtra]
exten => _94XXXXXXX,1,Set(callSts=${CURL(http://192.168.1.10:8080/v1/saveExtraCall/${CALLERID(num)}/${DIALSTATUS})})
exten => _94XXXXXXX,2,Return()

[regExtraInter]
exten => _+35194XXXXXXX,1,Set(callSts=${CURL(http://192.168.1.10:8080/v1/saveExtraCall/${CALLERID(num)}/${DIALSTATUS})})
exten => _+35194XXXXXXX,2,Return()

// Gateway Comms

exten => _200,1,DIAL(SIP/${EXTEN}@empresax,timeout)